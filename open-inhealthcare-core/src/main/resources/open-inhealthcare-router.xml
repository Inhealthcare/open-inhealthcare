<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camel="http://camel.apache.org/schema/spring"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
    http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

	<context:property-placeholder
		location="classpath:open-inhealthcare-router-defaults.properties" />

	<bean id="hl7codec" class="org.apache.camel.component.hl7.HL7MLLPCodec">
		<property name="charset" value="iso-8859-1" />
	</bean>
	<bean id="hl7dataformat" class="org.apache.camel.component.hl7.HL7DataFormat" />

	<!-- Configure the message processors -->
	<bean id="ackProcess" class="uk.co.inhealthcare.open.jsat.hl7.AckProcessor" />

	<!-- Configure message handlers -->
	<bean id="unsupportedHL7MessageHandler"
		class="uk.co.inhealthcare.open.jsat.hl7.UnsupportedHL7MessageHandler" />
	<bean id="hl7MessageDispatcher" class="uk.co.inhealthcare.open.jsat.hl7.HL7MessageDispatcher" />

	<!-- Configure the email outbound message senders -->
	<bean id="technicalAlertSender" class="uk.co.inhealthcare.open.jsat.services.EmailSenderImpl">
		<property name="template" ref="template" />
		<property name="subject">
			<value>${alerts.technical.email.subject}</value>
		</property>
		<property name="contentTransformer">
			<value>${alerts.technical.email.xslt}</value>
		</property>
		<property name="to">
			<value>${alerts.technical.email.to}</value>
		</property>
		<property name="from">
			<value>${alerts.technical.email.from}</value>
		</property>
	</bean>

	<bean id="businessAlertSender" class="uk.co.inhealthcare.open.jsat.services.EmailSenderImpl">
		<property name="template" ref="template" />
		<property name="subject">
			<value>${alerts.business.email.subject}</value>
		</property>
		<property name="contentTransformer">
			<value>${alerts.business.email.xslt}</value>
		</property>
		<property name="to">
			<value>${alerts.business.email.to}</value>
		</property>
		<property name="from">
			<value>${alerts.business.email.from}</value>
		</property>
	</bean>

	<camel:camelContext id="camel"
		xmlns="http://camel.apache.org/schema/spring">
		<package>uk.co.inhealthcare.open.jsat.routes</package>
		<template id="template" />

		<camel:endpoint id="smscListener"
			uri="mina2:tcp://localhost:${router.hl7.tcp.port}?sync=true&amp;codec=#hl7codec" />
		<camel:endpoint id="pasUpdate"
			uri="mina2:tcp://localhost:${pas.update.tcp.port}?sync=true&amp;codec=#hl7codec" />
		<!-- TODO: Is there a way of securing these credentials? (other than just 
			using a properties file) -->
		<camel:endpoint id="emailGateway" uri="${email.gateway}" />

	</camel:camelContext>

</beans>
